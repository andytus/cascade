{% extends 'base.html' %}
{% block title %}Ticket Reports (Download){% endblock %}
{% block main_content %}

    <div class="box-info" >
        <div id="ticket-query" class="well search-queries" data-bind="with: $root.report">
            Show <select id="ticket-query-select-status" data-bind="options: ticket_status_options,
             value: selected_status" class="input-medium"></select> tickets for
            <select id="ticket-query-select-type" data-bind="options: $root.report.ticket_type_options,
             value: selected_type" class="input-large"></select> services, and
            <select id="ticket-query-cart-type" data-bind="options: cart_type_options,
            value: selected_cart_type" class="input-medium"></select> cart type(s), and
            <select id="ticket-query-cart-type-size" data-bind="options: cart_size_options,
            value: selected_cart_size" class="input-small"></select> gallon cart(s).
            <button id="on_screen" class="run_query btn-primary"> Go <i class="icon-arrow-right"></i></button>
            <button id="download_csv" class="run_query btn btn-success">
                <i class="icon-download pull-right" title="Download"></i></button>
            <button id="download_pdf" class="run_query btn btn-success">
                <i class="icon-file"></i></button>

            <div id="ticket-query-advanced">
                <button type="button" class="btn btn-info" data-toggle="collapse"
                        data-target="#ticket-query-advanced-options">
                    <i class="icon-plus-sign"></i> More Options
                </button>

                <div id="ticket-query-advanced-options" class="collapse">
                    Created within the last:
                   <select  id="ticket-query-search-days" data-bind="options:$root.report.search_days,
                     optionsText:'display', value:$root.report.selected_search_days"> </select>
                    or exactly: <input type="text"
                                data-bind="value:$root.report.selected_search_days().value"> day(s).
                    <br><br>
                    Route Type:
                    <select id="ticket-query-select-route-type" data-bind="options: $root.report.route_types,
                    value: $root.report.selected_route_type"> </select>
                    Route Day:
                    <select id="ticket-query-select-route-day" data-bind="options: $root.report.route_days,
                    value: $root.report.selected_route_day"> </select>
                    Route:
                    <select id="ticket-query-select-route" data-bind="options: $root.report.filtered_routes,
                    optionsText:'route', value: $root.report.selected_route"> </select>

                </div>

            </div>
        </div>
    </div>

    <div id="ticket_panel" data-bind="with: tickets">
        <div id="ticket-table" class="gridStyle box-info" data-bind="koGrid: gridOptions" style="height: 500px">
        </div>

    </div>

{% endblock %}

{% block page_scripts %}
    {% load compressed %}
    {% compressed_js 'models_ticket' %}
    {% compressed_js 'models_route' %}
    {% compressed_js 'views_tickets_list' %}
    {% compressed_js 'views_tickets_report' %}



    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}js/vendor/knockout/kogrid/KoGrid.css"/>
    <script type="text/javascript" src="{{ STATIC_URL }}js/vendor/knockout/kogrid/koGrid-2.1.1.js"></script>

    <script type="text/javascript">
        var customer_id = null;
        var cart_serial_number = null;
        var tickets_api_download = "{% url "tickets_api_download" %}";
        var ticket_service_type_api = "{% url "ticket_service_type_api" %}";
        var ticket_app_profile_url = "{% url "ticket_app_profile" %}";
        var ticket_status_api = "{% url "ticket_status_api" %}";
        var cart_type_api = "{% url "cart_type_api" %}";
        var cart_app_profile_url = "{% url "cart_app_profile" %}";
        var route_search_api_url = "{% url "route_search_api" %}";
        var ticketsReport = {
            report: new cartlogic.TicketsReportViewModel,
            tickets: new cartlogic.TicketsListViewModel(null, null, tickets_api_download)
        };

        ko.applyBindings(ticketsReport, document.getElementById('main'));

        ticketsReport.tickets.getPagedDataAsync();

    </script>

{% endblock %}
